# API для опросов


### Инструменты разработки

**Стек:**
- Python >= 3.9
- Django >= 3.2.7
- Postgres

## Старт

#### 1) В корне проекта создать .env

    DEBUG=1
    SECRET_KEY=vyug78g87gt67g8
    ALLOWED_HOSTS=localhost 127.0.0.1 [::1]
    
    SQL_ENGINE=django.db.backends.postgresql
    SQL_DATABASE=polls_db
    SQL_USER=polls-user
    SQL_PASSWORD=admin123
    SQL_HOST=db
    SQL_PORT=5432
    DATABASE=postgres

#### 2) В корне проекта создать .env.db

    POSTGRES_DB=polls_db
    POSTGRES_USER=polls-user
    POSTGRES_PASSWORD=admin123

#### 3) Создать образ

    docker-compose build

#### 4) Запустить контейнер

    docker-compose up
    
#### 5) Перейти по адресу

    http://127.0.0.1:8000/docs

## Документация

#### Метод /api/polls/

Тип: GET

Метод возвращает все активные опросы

Параметры ответа:

| Параметр | Тип | Описание |
| ------------- | ------------------ | ----- |
| id | int | ID опроса |
| name |string | Название опроса |
| start_date | string | Дата старта |
| end_date | string | Дата окончания |
| description | string | Описание |
| question_set | array | Список объектов вопросов |


### Метод /api/polls/create

Тип: POST

Метод создает опрос

Параметры запроса:

| Параметр | Тип | Обязательный | Описание |
| ------------- | ------------------ | --- | ----- |
| name |string | Да | Название опроса |
| start_date | string | Да | Дата старта |
| end_date | string | Да | Дата окончания |
| description | string | Да | Описание |

Параметры ответа аналогичны параметрам ответа метода /api/polls/

### Метод /api/polls/{id}/

Тип: GET

Метод для получения информации об опросе через его id

Параметры ответа аналогичны параметрам ответа метода /api/polls/

### Метод /api/polls/{id}/

Тип: PUT

Метод изменяет информацию опроса по указанному id

Параметры запроса/ответа аналогичны параметрам запроса/ответа метода /api/polls/create/

### Метод /api/polls/{id}/

Тип: DELETE

Метод удаляет опрос

### Метод /api/polls/{poll_id}/questions/

Тип: GET

Метод возвращает все вопросы определенного опроса

Параметры ответа:

| Параметр | Тип | Описание |
| ------------- | ------------------ | ----- |
| id | int | ID вопроса |
| text |string | Текст вопроса |
| type | string | Тип вопроса |
| poll | int | ID опроса |
| choiceanswer_set | array | Список ответов для выбора |

### Метод /api/polls/{poll_id}/questions/create/

Тип: POST

Метод создает вопрос

Параметры запроса:

| Параметр | Тип | Обязательный | Описание |
| ------------- | ------------------ | ----- | ----- |
| text |string | Да | Текст вопроса |
| type | string | Да | Тип вопроса |
| choiceanswer_set | array | Нет | Список ответов для выбора |

Параметры ответа аналогичны параметрам ответа метода /api/polls/{poll_id}/questions/

### Метод /api/polls/questions/{id}/

Тип: GET

Метод для получения информации о вопросе через его id.

Параметры ответа аналогичны параметрам ответа метода /api/polls/{poll_id}/questions/

### Метод /api/polls/questions/{id}/

Тип: PUT

Метод изменяет информацию вопроса по указанному id

Параметры запроса/ответа аналогичны параметрам запроса/ответа метода /api/polls/{poll_id}/questions/create/

### Метод /api/polls/{poll_id}/questions/{id}/

Тип: DELETE

Метод удаляет вопрос

### Метод /api/polls/{poll_id}/questions/{id}/answer/

Тип: POST

Метод создает ответ для вопроса

Параметры запроса:

| Параметр | Тип | Обязательный | Описание |
| ------------- | ------------------ | ----- | ----- |
| user_id |int | Да | ID пользователя |
| answer | string | Нет | Ответ пользователя в виде текста |
| selected_answers | array | Нет | Выбранные пользователем ответы |

Параметры ответа:

| Параметр | Тип | Описание |
| ------------- | ------------------ | ----- |
| id | int | ID ответа |
| user_id |int | ID пользователя |
| answer | string | Ответ пользователя в виде текста |
| selected_answers | array | Выбранные пользователем ответы |

### Метод /api/polls/users/{user_id}/answers/

Тип: GET

Метод возвращает все ответы определенного пользователя

Параметры ответа:

| Параметр | Тип | Описание |
| ------------- | ------------------ | ----- |
| id | int | ID ответа |
| user_id |int | ID пользователя |
| answer |string | Ответ пользователя в виде текста |
| selected_answers | array | Выбранные пользователем ответы |
| question |obj | Объект вопроса |